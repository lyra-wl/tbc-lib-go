# tbc-lib-go 文件结构说明

## 最终目录结构

```
tbc-lib-go/
├── 根目录 (package bt)
│   ├── 交易核心模块
│   │   ├── tx.go                    # 交易主结构
│   │   ├── input.go                 # 交易输入
│   │   ├── output.go                # 交易输出
│   │   ├── txinput.go               # 输入构建方法
│   │   ├── txoutput.go              # 输出构建方法
│   │   ├── txchange.go              # 找零处理
│   │   ├── txjson.go                # JSON 序列化
│   │   ├── txjson_node.go           # 节点格式 JSON
│   │   └── *_test.go                # 测试文件
│   │
│   ├── 签名模块
│   │   ├── signaturehash.go          # 签名哈希计算
│   │   └── signaturehash_test.go
│   │
│   ├── 费用模块
│   │   ├── fees.go                   # 费用计算
│   │   └── fees_test.go
│   │
│   ├── UTXO 模块
│   │   ├── utxo.go                   # UTXO 结构
│   │   ├── utxojson.go               # UTXO JSON 处理
│   │   └── utxojson_test.go
│   │
│   ├── 工具模块
│   │   ├── varint.go                 # VarInt 编码
│   │   ├── bytemanipulation.go       # 字节操作
│   │   ├── consts.go                 # 常量定义
│   │   ├── errors.go                 # 错误定义
│   │   ├── docs.go                   # 文档
│   │   └── *_test.go
│   │
│   └── unlocker.go                   # 解锁器接口定义
│
├── bscript/                          # 脚本模块 (package bscript)
│   ├── script.go
│   ├── address.go
│   ├── interpreter/
│   └── ...
│
├── unlocker/                         # 解锁器实现 (package unlocker)
│   ├── simple.go
│   └── simple_test.go
│
├── sighash/                          # 签名哈希标志 (package sighash)
│   └── flag.go
│
└── examples/                         # 示例代码
    └── ...
```

## 模块说明

### package bt (主包)
所有核心功能都在根目录的 `package bt` 中，包括：

1. **交易核心模块**
   - `tx.go` - 交易主结构体和方法
   - `input.go` / `output.go` - 交易输入输出
   - `txinput.go` / `txoutput.go` - 输入输出构建方法
   - `txchange.go` - 找零处理
   - `txjson.go` / `txjson_node.go` - JSON 序列化

2. **签名模块**
   - `signaturehash.go` - 签名哈希计算（Legacy 和 ForkID）

3. **费用模块**
   - `fees.go` - 费用计算和验证

4. **UTXO 模块**
   - `utxo.go` - UTXO 数据结构
   - `utxojson.go` - UTXO JSON 处理

5. **工具模块**
   - `varint.go` - VarInt 编码
   - `bytemanipulation.go` - 字节操作工具
   - `consts.go` - 常量定义
   - `errors.go` - 错误定义
   - `docs.go` - 包文档

6. **解锁器接口**
   - `unlocker.go` - Unlocker 和 UnlockerGetter 接口定义

### package unlocker (独立包)
解锁器的具体实现：
- `unlocker/simple.go` - 简单的私钥解锁器实现

### package bscript (独立包)
脚本处理相关功能，包括脚本构建、地址处理、脚本解释器等。

### package sighash (独立包)
签名哈希标志定义。

## 文件命名约定

虽然所有 `package bt` 的文件都在根目录，但通过文件命名可以清晰识别模块：

- `tx*.go` - 交易相关
- `*input*.go` - 输入相关
- `*output*.go` - 输出相关
- `*change*.go` - 找零相关
- `*json*.go` - JSON 相关
- `signature*.go` - 签名相关
- `fees*.go` - 费用相关
- `utxo*.go` - UTXO 相关
- `varint*.go` - VarInt 相关
- `*manipulation*.go` - 字节操作相关

## 注意事项

⚠️ **Go 包结构限制**：
- 在 Go 中，同一个包的所有文件必须在同一个目录中
- 因此，所有 `package bt` 的文件都在根目录
- 独立的包（如 `unlocker`, `bscript`）可以有自己的目录

## 使用示例

```go
import (
    "github.com/sCrypt-Inc/go-bt/v2"           // package bt
    "github.com/sCrypt-Inc/go-bt/v2/unlocker"  // package unlocker
    "github.com/sCrypt-Inc/go-bt/v2/bscript"   // package bscript
)

// 使用 bt 包
tx := bt.NewTx()
tx.From("txid", 0, "script", 1000)
tx.PayToAddress("address", 500)

// 使用 unlocker 包
unlocker := &unlocker.Simple{PrivateKey: privKey}
tx.FillAllInputs(ctx, unlocker)
```

